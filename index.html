<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>OGPä»˜ãURLçŸ­ç¸®ãƒ„ãƒ¼ãƒ«</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
      background: #fafafa;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, textarea, button {
      width: 100%;
      margin-top: 10px;
      padding: 8px;
      font-size: 15px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover { background: #0056b3; }
    h2 { text-align: center; }
  </style>
</head>
<body>
  <h2>ğŸ”— OGPä»˜ãURLçŸ­ç¸®ãƒ„ãƒ¼ãƒ«</h2>

  <label>å…ƒã®URLï¼š</label>
  <input id="url" placeholder="https://example.com" />

  <label>ã‚¿ã‚¤ãƒˆãƒ«ï¼š</label>
  <input id="title" placeholder="ãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä»»æ„ï¼‰" />

  <label>èª¬æ˜ï¼š</label>
  <textarea id="desc" rows="3" placeholder="èª¬æ˜æ–‡ï¼ˆä»»æ„ï¼‰"></textarea>

  <label>ç”»åƒURLï¼š</label>
  <input id="image" placeholder="https://example.com/image.jpg" />

  <button id="create">çŸ­ç¸®URLã‚’ä½œæˆ</button>

  <p id="result"></p>

  <script>
    const supabase = window.supabase.createClient(
      "https://jfpccwjwsgxkpnddnkrn.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmcGNjd2p3c2d4a3BuZGRua3JuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2MTAzNzUsImV4cCI6MjA3NTE4NjM3NX0.8gJuCKSE5KsaEG5GDGWH1brEBCfZ3dEHXtAELcX4KOk"
    );

    document.getElementById("create").addEventListener("click", async () => {
      const url = document.getElementById("url").value.trim();
      const title = document.getElementById("title").value.trim();
      const desc = document.getElementById("desc").value.trim();
      const image = document.getElementById("image").value.trim();

      if (!url) {
        alert("URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
        return;
      }

      // ãƒ©ãƒ³ãƒ€ãƒ ãª6æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
      const code = Math.random().toString(36).substring(2, 8);

      // Supabaseã«ä¿å­˜
      const { error } = await supabase.from("links").insert([
        { code, url, title, description: desc, image }
      ]);

      if (error) {
        console.error("Error:", error);
        document.getElementById("result").textContent = "âŒ ã‚¨ãƒ©ãƒ¼ï¼š" + error.message;
      } else {
        const shortUrl = `${window.location.origin}/ogp/${code}`;
        document.getElementById("result").innerHTML = `
          âœ… çŸ­ç¸®URLä½œæˆæˆåŠŸï¼<br>
          <a href="${shortUrl}" target="_blank">${shortUrl}</a>
        `;
      }
    });
  </script>
</body>
</html>
