<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>URL短縮ツール</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>🔗 URL短縮ツール</h1>
  <input type="text" id="urlInput" placeholder="元のURLを入力" size="40">
  <button onclick="shortenUrl()">短縮する</button>
  <p id="result"></p>

  <script>
    const supabaseUrl = "https://jfpccwjwsgxkpnddnkrn.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmcGNjd2p3c2d4a3BuZGRua3JuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2MTAzNzUsImV4cCI6MjA3NTE4NjM3NX0.8gJuCKSE5KsaEG5GDGWH1brEBCfZ3dEHXtAELcX4KOk";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function shortenUrl() {
      const url = document.getElementById("urlInput").value;
      if (!url) return alert("URLを入力してください");

      // ランダム6文字コードを生成
      const code = Math.random().toString(36).substring(2, 8);

      const { error } = await supabase.from("links").insert([{ code, url }]);
      if (error) {
        alert("保存に失敗しました：" + error.message);
        return;
      }

      const shortUrl = `${window.location.origin}/redirect.html?code=${code}`;
      document.getElementById("result").innerHTML =
        `✅ 短縮URL: <a href="${shortUrl}" target="_blank">${shortUrl}</a>`;
    }
  </script>
</body>
</html>
